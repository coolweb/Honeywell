<div style="width:300px;height:100px;" class="eqLogic-widget eqLogic" data-eqLogic_id="#id#" data-eqLogic_uid="#uid#" data-version="#version#">
    <center class="widget-name"><strong><a href="#eqLink#" style="font-size : 1.1em;">#name_display# <span style="font-size: 0.85em;position: relative;top:-2px;">#object_name#</span></a></strong></center>
    <br />
    <div class="row">
        <center style="font-weight: bolder; font-size: 14pt">
            #temperature# °C
        </center>
    </div>
    <div class="row">
        <center style="font-weight: bolder; font-size: 14pt">
            <button type="button" name="temperatureDown" class="btn btn-primary">-</button><span name="setPoint">#wantedTemperature#</span>            °C<button type="button" name="temperatureUp" class="btn btn-primary">+</button>
        </center>
    </div>
    <div class="row">
        <center>
            <div class="btn-group" data-toggle="buttons">
                <label class="btn btn-secondary">
                    <input type="radio" name="optionsSetPoint" id="scheduled" autocomplete="off">
                     Auto
                </label>
                <label class="btn btn-secondary active">
                    <input type="radio" name="optionsSetPoint" id="permanent" checked autocomplete="off">
                    <span class="glyphicon glyphicon-repeat" title="Permanent"></span>
                </label>
                <label class="btn btn-secondary">
                    <input type="radio" name="optionsSetPoint" id="min30" autocomplete="off"> 30 min
                </label>
                <label class="btn btn-secondary">
                    <input type="radio" name="optionsSetPoint" id="min60" autocomplete="off"> 1h
                </label>
                <label class="btn btn-secondary">
                    <input type="radio" name="optionsSetPoint" id="min120" autocomplete="off"> 2h
                </label>
            </div>
        </center>
    </div>
</div>

<script>
    var honeywell = honeywell || {};
    honeywell.valves = honeywell.valves || [];

    honeywell.valves['#uid#'] = honeywell.valves['#uid#'] ||
     {
        timerChangeTemp: null,
        currentTemp: 0,
        tempStatus: 'permanent',
        until: undefined
     };

    $('.eqLogic[data-eqLogic_uid=#uid#] button[name="temperatureUp"]').on('click', function () {
        if (honeywell.valves['#uid#'].timerChangeTemp !== null) {
            clearTimeout(honeywell.valves['#uid#'].timerChangeTemp);
        }

        honeywell.valves['#uid#'].timerChangeTemp = setTimeout(function () {
            honeywell.valves['#uid#'].until = new Date();
            honeywell.valves['#uid#'].until.setMinutes(honeywell.valves['#uid#'].until.getMinutes() + 120);

            jeedom.cmd.execute({ id: '#SetTemperature_id#', value: 
            {
                heatSetpoint: honeywell.valves['#uid#'].currentTemp, 
                status: honeywell.valves['#uid#'].tempStatus, 
                until: honeywell.valves['#uid#'].until.toJSON()}});
        }, 2000);

        honeywell.valves['#uid#'].currentTemp = $('.eqLogic[data-eqLogic_uid=#uid#] span[name="setPoint"]')[0].innerText;
        honeywell.valves['#uid#'].currentTemp = Number(honeywell.valves['#uid#'].currentTemp) + 0.5;
        $('.eqLogic[data-eqLogic_uid=#uid#] span[name="setPoint"]')[0].innerText = honeywell.valves['#uid#'].currentTemp;
    });

    $('.eqLogic[data-eqLogic_uid=#uid#] button[name="temperatureDown"]').on('click', function () {
        if (honeywell.valves['#uid#'].timerChangeTemp !== null) {
            clearTimeout(honeywell.valves['#uid#'].timerChangeTemp);
        }

        honeywell.valves['#uid#'].timerChangeTemp = setTimeout(function () {
            honeywell.valves['#uid#'].until = new Date();
            honeywell.valves['#uid#'].until.setMinutes(honeywell.valves['#uid#'].until.getMinutes() + 120);
            
            jeedom.cmd.execute({ id: '#SetTemperature_id#', value: 
            {
                heatSetpoint: honeywell.valves['#uid#'].currentTemp, 
                status: honeywell.valves['#uid#'].tempStatus, 
                until: honeywell.valves['#uid#'].until.toJSON()}});
        }, 2000);

        honeywell.valves['#uid#'].currentTemp = $('.eqLogic[data-eqLogic_uid=#uid#] span[name="setPoint"]')[0].innerText;
        honeywell.valves['#uid#'].currentTemp = Number(honeywell.valves['#uid#'].currentTemp) - 0.5;
        $('.eqLogic[data-eqLogic_uid=#uid#] span[name="setPoint"]')[0].innerText = honeywell.valves['#uid#'].currentTemp;
    });

    $('.eqLogic[data-eqLogic_uid=#uid#] .btn-group .btn input').on('change', function () {
        var checkedId = $('.eqLogic[data-eqLogic_uid=#uid#] [name="optionsSetPoint"]:checked').attr('id');

        if(checkedId === 'permanent'){
            honeywell.valves['#uid#'].tempStatus = 'permanent';
        }

        if(checkedId === 'scheduled'){
            honeywell.valves['#uid#'].tempStatus = 'scheduled';
            var currentTemp = $('.eqLogic[data-eqLogic_uid=#uid#] span[name="setPoint"]')[0].innerText;
            jeedom.cmd.execute({ id: '#SetTemperature_id#', value: {
                heatSetpoint: honeywell.valves['#uid#'].currentTemp, 
                status: honeywell.valves['#uid#'].tempStatus
            }});
        }

        if(checkedId === 'min30'){
            honeywell.valves['#uid#'].tempStatus = 'temporary';
            
            honeywell.valves['#uid#'].until = new Date();
            honeywell.valves['#uid#'].until.setMinutes(honeywell.valves['#uid#'].until.getMinutes() + 30);
            honeywell.valves['#uid#'].until.setMinutes(honeywell.valves['#uid#'].until.getMinutes() + 120);
        }

        if(checkedId === 'min60'){
            honeywell.valves['#uid#'].tempStatus = 'temporary';
            honeywell.valves['#uid#'].until = new Date();
            honeywell.valves['#uid#'].until.setMinutes(honeywell.valves['#uid#'].until.getMinutes() + 60);
            honeywell.valves['#uid#'].until.setMinutes(honeywell.valves['#uid#'].until.getMinutes() + 120);
        }

        if(checkedId === 'min120'){
            honeywell.valves['#uid#'].tempStatus = 'temporary';
            honeywell.valves['#uid#'].until = new Date();
            honeywell.valves['#uid#'].until.setMinutes(honeywell.valves['#uid#'].until.getMinutes() + 120);
            honeywell.valves['#uid#'].until.setMinutes(honeywell.valves['#uid#'].until.getMinutes() + 120);
        }
    });
</script>